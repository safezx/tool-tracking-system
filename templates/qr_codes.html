<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR-–∫–æ–¥—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤</title>
    <style>
        body { font-family: Arial; margin: 20px; }
        h1 { color: #333; }
        .header-links { margin-bottom: 20px; }
        .header-links a { 
            display: inline-block; margin-right: 10px; padding: 8px 15px;
            background: #4CAF50; color: white; text-decoration: none;
            border-radius: 5px;
        }
        .qr-grid { 
            display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px; margin-top: 20px;
        }
        .qr-card { 
            background: white; padding: 15px; border-radius: 8px;
            border: 1px solid #ddd; text-align: center;
        }
        .qr-card h3 { margin-top: 0; }
        .qr-code { 
            padding: 10px; background: #f5f5f5; border-radius: 5px;
            margin: 10px 0; font-family: monospace; font-size: 18px;
        }
        .qr-link { 
            display: block; margin-top: 10px; padding: 8px;
            background: #e3f2fd; border-radius: 4px;
            word-break: break-all; font-size: 12px;
        }
        .qr-meta { 
            font-size: 12px; color: #666; margin-top: 8px;
            border-top: 1px solid #eee; padding-top: 8px;
        }
    </style>
</head>
<body>
    <h1>üîó QR-–∫–æ–¥—ã –≤—Å–µ—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤</h1>
    
    <div class="header-links">
        <a href="/">üè† –ì–ª–∞–≤–Ω–∞—è</a>
        <a href="/admin/tools">üõ†Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏</a>
        <a href="/admin/">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
    </div>
    
    <div style="margin: 15px 0; padding: 10px; background: #e8f5e9; border-radius: 5px;">
        <strong>‚è∞ –í—Ä–µ–º—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–ú–æ—Å–∫–≤–∞):</strong> {{ format_moscow_time(get_moscow_time(), '%d.%m.%Y %H:%M:%S') }}
    </div>
    
    {% for category, tools in tools_by_category.items() %}
    <h2>{{ category }}</h2>
    <div class="qr-grid">
        {% for tool in tools %}
        <div class="qr-card">
            <h3>{{ tool.name }}</h3>
            <div class="qr-code">{{ tool.qr_code_identifier }}</div>
            <p>–ú–µ—Å—Ç–æ: {{ tool.location or '‚Äî' }}</p>
            <p>–°—Ç–∞—Ç—É—Å: {% if tool.is_available %}‚úÖ –î–æ—Å—Ç—É–ø–µ–Ω{% else %}‚ùå –í—ã–¥–∞–Ω{% endif %}</p>
            
            <!-- –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—ã–¥–∞—á–µ, –µ—Å–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≤—ã–¥–∞–Ω -->
            {% if not tool.is_available %}
                {% set active_request = tool.requests|selectattr('status', 'equalto', 'approved')|first %}
                {% if active_request %}
                <div class="qr-meta">
                    <strong>–í—ã–¥–∞–Ω:</strong> {{ active_request.user.full_name() }}<br>
                    <strong>–ü–æ–ª—É—á–µ–Ω:</strong> {{ format_moscow_time(active_request.approval_time) }}<br>
                    <strong>–í–µ—Ä–Ω—É—Ç—å –¥–æ:</strong> {{ format_moscow_time(active_request.expected_return_time) }}
                </div>
                {% endif %}
            {% endif %}
            
            <a class="qr-link" href="/tool/{{ tool.qr_code_identifier }}" target="_blank">
                {{ request.host_url }}tool/{{ tool.qr_code_identifier }}
            </a>
            <div style="margin-top: 10px;">
                <a href="/tool/{{ tool.qr_code_identifier }}" target="_blank" style="
                    padding: 5px 10px; background: #4CAF50; color: white;
                    text-decoration: none; border-radius: 4px; font-size: 14px;
                ">–ö–∞—Ä—Ç–æ—á–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞</a>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endfor %}
    
    <div style="margin-top: 30px; padding: 20px; background: #f5f5f5; border-radius: 8px;">
        <h3>üìã –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å QR-–∫–æ–¥—ã:</h3>
        <ol>
            <li>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫—É –ø–æ–¥ QR-–∫–æ–¥–æ–º</li>
            <li>–í—Å—Ç–∞–≤—å—Ç–µ –≤ –ª—é–±–æ–π QR-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, qr-code-generator.com)</li>
            <li>–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∏ —Å–∫–∞—á–∞–π—Ç–µ QR-–∫–æ–¥</li>
            <li>–†–∞—Å–ø–µ—á–∞—Ç–∞–π—Ç–µ –∏ –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ –∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É</li>
        </ol>
        <p><strong>–ò–ª–∏ –ø—Ä–æ—Å—Ç–æ –æ—Ç–∫—Ä–æ–π—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</strong></p>
    </div>
</body>
</html>