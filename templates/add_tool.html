<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            border-bottom: 3px solid #4CAF50;
            padding-bottom: 10px;
            margin-bottom: 25px;
        }
        
        .header-links {
            margin-bottom: 20px;
        }
        
        .header-links a {
            display: inline-block;
            margin-right: 15px;
            padding: 8px 15px;
            background: #4CAF50;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-weight: bold;
        }
        
        .header-links a:hover {
            background: #45a049;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        .form-group textarea {
            height: 100px;
            resize: vertical;
        }
        
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }
        
        .required:after {
            content: " *";
            color: #f44336;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn-submit {
            background-color: #4CAF50;
            color: white;
            width: 100%;
            margin-top: 20px;
        }
        
        .btn-submit:hover {
            background-color: #45a049;
        }
        
        .btn-cancel {
            background-color: #9E9E9E;
            color: white;
            margin-right: 10px;
        }
        
        .btn-cancel:hover {
            background-color: #757575;
        }
        
        .form-help {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .qr-preview {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            text-align: center;
            border: 1px dashed #ddd;
        }
        
        .qr-preview h3 {
            margin-top: 0;
        }
        
        .qr-code-display {
            font-family: monospace;
            font-size: 20px;
            background: white;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            display: inline-block;
            border: 1px solid #ddd;
        }
        
        .qr-link {
            display: block;
            margin-top: 10px;
            padding: 10px;
            background: #e3f2fd;
            border-radius: 4px;
            word-break: break-all;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç</h1>
        
        <div class="header-links">
            <a href="/admin/tools">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤</a>
            <a href="/admin/">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
        </div>
        
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        <form method="POST" action="/admin/add-tool" id="addToolForm">
            <div class="form-row">
                <div class="form-group">
                    <label for="name" class="required">–ù–∞–∑–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞</label>
                    <input type="text" id="name" name="name" required 
                           placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –®—É—Ä—É–ø–æ–≤—ë—Ä—Ç DeWalt DCD791D2">
                </div>
                
                <div class="form-group">
                    <label for="category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                    <select id="category" name="category">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                        <option value="–≠–ª–µ–∫—Ç—Ä–æ–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç">–≠–ª–µ–∫—Ç—Ä–æ–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç</option>
                        <option value="–†—É—á–Ω–æ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç">–†—É—á–Ω–æ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç</option>
                        <option value="–ò–∑–º–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–π">–ò–∑–º–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–π</option>
                        <option value="–°–≤–∞—Ä–æ—á–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ">–°–≤–∞—Ä–æ—á–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</option>
                        <option value="–ü–Ω–µ–≤–º–∞—Ç–∏—á–µ—Å–∫–∏–π">–ü–Ω–µ–≤–º–∞—Ç–∏—á–µ—Å–∫–∏–π</option>
                        <option value="–°—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–π">–°—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–π</option>
                        <option value="–°–∞–¥–æ–≤–∞—è —Ç–µ—Ö–Ω–∏–∫–∞">–°–∞–¥–æ–≤–∞—è —Ç–µ—Ö–Ω–∏–∫–∞</option>
                        <option value="–ü—Ä–æ—á–µ–µ">–ü—Ä–æ—á–µ–µ</option>
                        <option value="custom">‚ûï –î—Ä—É–≥–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è (–≤–≤–µ—Å—Ç–∏ –≤—Ä—É—á–Ω—É—é)...</option>
                    </select>
                    <div class="form-help">–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é</div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="description">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                <textarea id="description" name="description" 
                          placeholder="–û–ø–∏—à–∏—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏, –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—é, –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏..."></textarea>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="location">–ú–µ—Å—Ç–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è</label>
                    <input type="text" id="location" name="location" 
                           placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –°–∫–ª–∞–¥ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤, –¶–µ—Ö ‚Ññ1, –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è">
                </div>
                
                <div class="form-group">
                    <label for="storage_place">–ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –º–µ—Å—Ç–æ</label>
                    <input type="text" id="storage_place" name="storage_place" 
                           placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –®–∫–∞—Ñ –ê, –ø–æ–ª–∫–∞ 3, –Ø—â–∏–∫ ‚Ññ2">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="serial_number">–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä</label>
                    <input type="text" id="serial_number" name="serial_number" 
                           placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: DWT-2023-001">
                </div>
                
                <div class="form-group">
                    <label for="model">–ú–æ–¥–µ–ª—å</label>
                    <input type="text" id="model" name="model" 
                           placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: DCD791D2, GBH 2-28">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="manufacturer">–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å</label>
                    <input type="text" id="manufacturer" name="manufacturer" 
                           placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: DeWalt, Bosch, Fluke">
                </div>
                
                <div class="form-group">
                    <label for="price">–¶–µ–Ω–∞ (—Ä—É–±.)</label>
                    <input type="number" id="price" name="price" min="0" step="0.01" 
                           placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 18990.00">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="purchase_date">–î–∞—Ç–∞ –ø—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–∏—è</label>
                    <input type="date" id="purchase_date" name="purchase_date">
                </div>
                
                <div class="form-group">
                    <label for="warranty_until">–ì–∞—Ä–∞–Ω—Ç–∏—è –¥–æ</label>
                    <input type="date" id="warranty_until" name="warranty_until">
                </div>
            </div>
            
            <div class="form-group">
                <div class="form-help">
                    <strong>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:</strong> QR-–∫–æ–¥ –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
                </div>
            </div>
            
            <div class="form-buttons">
                <a href="/admin/tools" class="btn btn-cancel">–û—Ç–º–µ–Ω–∞</a>
                <button type="submit" class="btn btn-submit">–î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç</button>
            </div>
        </form>
        
        <!-- –ë–ª–æ–∫ –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ (–±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è JavaScript) -->
        <div id="qrPreview" class="qr-preview" style="display: none;">
            <h3>‚úÖ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!</h3>
            <p>QR-–∫–æ–¥ –¥–ª—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞:</p>
            <div class="qr-code-display" id="generatedQrCode"></div>
            <p>–°—Å—ã–ª–∫–∞ –¥–ª—è –≤–∑—è—Ç–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞:</p>
            <div class="qr-link" id="generatedQrLink"></div>
            <p style="margin-top: 15px;">
                <a href="/admin/tools" class="btn" style="background: #4CAF50; color: white;">–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É</a>
                <a href="/admin/add-tool" class="btn" style="background: #2196F3; color: white;">–î–æ–±–∞–≤–∏—Ç—å –µ—â—ë</a>
            </p>
        </div>
    </div>
    
    <script>
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
        document.getElementById('addToolForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            
            fetch('/admin/add-tool', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—à–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                    showSuccess(data);
                } else {
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
                    alert('–û—à–∏–±–∫–∞: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ä–º—ã');
            });
        });
        
        function showSuccess(data) {
            // –°–∫—Ä—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É
            document.getElementById('addToolForm').style.display = 'none';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–ª–æ–∫ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
            const qrPreview = document.getElementById('qrPreview');
            qrPreview.style.display = 'block';
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
            document.getElementById('generatedQrCode').textContent = data.qr_code;
            document.getElementById('generatedQrLink').innerHTML = 
                '<a href="' + data.tool_url + '" target="_blank">' + data.tool_url + '</a>';
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
            qrPreview.scrollIntoView({ behavior: 'smooth' });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            alert('‚úÖ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!\nQR-–∫–æ–¥: ' + data.qr_code);
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã –¥–ª—è –ø–æ–ª—è –¥–∞—Ç—ã –ø—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('purchase_date').value = today;
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥–∞—Ä–∞–Ω—Ç–∏—é –Ω–∞ 1 –≥–æ–¥ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            const nextYear = new Date();
            nextYear.setFullYear(nextYear.getFullYear() + 1);
            document.getElementById('warranty_until').value = nextYear.toISOString().split('T')[0];
        });
    </script>
</body>
</html>


<script>

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ "–î—Ä—É–≥–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è"
document.getElementById('category').addEventListener('change', function() {
    const categorySelect = this;
    const customCategoryDiv = document.getElementById('customCategoryContainer');
    
    // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ –æ–ø—Ü–∏—è "–î—Ä—É–≥–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è"
    if (categorySelect.value === 'custom') {
        // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ø–æ–ª—è –≤–≤–æ–¥–∞, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
        if (!customCategoryDiv) {
            const container = document.createElement('div');
            container.id = 'customCategoryContainer';
            container.style.marginTop = '10px';
            
            const input = document.createElement('input');
            input.type = 'text';
            input.id = 'custom_category';
            input.name = 'custom_category';
            input.placeholder = '–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏';
            input.required = true;
            input.style.width = '100%';
            input.style.padding = '10px';
            input.style.border = '1px solid #ddd';
            input.style.borderRadius = '5px';
            
            container.appendChild(input);
            categorySelect.parentNode.appendChild(container);
        }
    } else {
        // –£–¥–∞–ª—è–µ–º –ø–æ–ª–µ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞, –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å
        if (customCategoryDiv) {
            customCategoryDiv.remove();
        }
    }
});

</script>