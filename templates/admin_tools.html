<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏</title>
    <style>
        /* –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            border-bottom: 3px solid #4CAF50;
            padding-bottom: 10px;
            margin-bottom: 25px;
        }
        
        .header-links {
            margin-bottom: 20px;
        }
        
        .header-links a {
            display: inline-block;
            margin-right: 15px;
            padding: 8px 15px;
            background: #4CAF50;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-weight: bold;
        }
        
        .header-links a:hover {
            background: #45a049;
        }
        
        .server-time {
            margin: 15px 0;
            padding: 10px;
            background: #e8f5e9;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            text-align: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .stat-card h3 {
            margin-top: 0;
            color: #666;
            font-size: 14px;
            text-transform: uppercase;
        }
        
        .stat-value {
            font-size: 2.2em;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .stat-available { color: #4CAF50; }
        .stat-taken { color: #f44336; }
        .stat-total { color: #2196F5; }
        
        .tools-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .tools-table th, .tools-table td {
            border: 1px solid #ddd;
            padding: 14px;
            text-align: left;
        }
        
        .tools-table th {
            background-color: #4CAF50;
            color: white;
            font-weight: bold;
            position: sticky;
            top: 0;
        }
        
        .tools-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .tools-table tr:hover {
            background-color: #f1f1f1;
        }
        
        .status-available {
            color: #4CAF50;
            font-weight: bold;
            background: #e8f5e9;
            padding: 4px 10px;
            border-radius: 4px;
            display: inline-block;
        }
        
        .status-taken {
            color: #f44336;
            font-weight: bold;
            background: #ffebee;
            padding: 4px 10px;
            border-radius: 4px;
            display: inline-block;
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        
        .btn-view {
            background-color: #2196F3;
            color: white;
        }
        
        .btn-edit {
            background-color: #FF9800;
            color: white;
        }
        
        .btn-delete {
            background-color: #f44336;
            color: white;
        }
        
        .btn-qr {
            background-color: #9C27B0;
            color: white;
        }
        
        .btn:hover {
            opacity: 0.9;
        }
        
        .search-filter {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
        }
        
        .search-filter h3 {
            margin-top: 0;
            color: #333;
        }
        
        .filter-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .filter-group {
            flex: 1;
            min-width: 200px;
        }
        
        .filter-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        
        .filter-group select,
        .filter-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .filter-buttons {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }
        
        .filter-buttons button {
            padding: 10px 20px;
            height: 42px;
        }
        
        .btn-apply {
            background-color: #4CAF50;
            color: white;
        }
        
        .btn-reset {
            background-color: #9E9E9E;
            color: white;
        }
        
        .no-data {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 1.2em;
        }
        
        .qr-code-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            z-index: 1000;
            max-width: 500px;
            width: 90%;
        }
        
        .qr-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }
        
        .qr-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .qr-close {
            background: #f44336;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .qr-content {
            text-align: center;
        }
        
        .qr-content img {
            max-width: 200px;
            margin: 20px auto;
        }
        
        .qr-link {
            display: block;
            margin-top: 15px;
            padding: 10px;
            background: #e3f2fd;
            border-radius: 5px;
            word-break: break-all;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤—ã–¥–∞—á–µ */
        .issued-info {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        .issued-info strong {
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üõ†Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏</h1>
        
        <div class="header-links">
            <a href="/">üè† –ì–ª–∞–≤–Ω–∞—è</a>
            <a href="/admin/">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
            <a href="/admin/qr-codes">üîó –í—Å–µ QR-–∫–æ–¥—ã</a>
        </div>
        
        <div class="server-time">
            <strong>‚è∞ –í—Ä–µ–º—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–ú–æ—Å–∫–≤–∞):</strong> {{ format_moscow_time(get_moscow_time(), '%d.%m.%Y %H:%M:%S') }}
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <h3>–í—Å–µ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤</h3>
                <div class="stat-value stat-total">{{ stats.total }}</div>
            </div>
            
            <div class="stat-card">
                <h3>–î–æ—Å—Ç—É–ø–Ω–æ —Å–µ–π—á–∞—Å</h3>
                <div class="stat-value stat-available">{{ stats.available }}</div>
            </div>
            
            <div class="stat-card">
                <h3>–í—ã–¥–∞–Ω–æ</h3>
                <div class="stat-value stat-taken">{{ stats.taken }}</div>
            </div>
        </div>
        
        <div class="header-links">
            <a href="/admin/add-tool" class="header-links">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç</a>
        </div> 

        <div class="search-filter">
            <h3>üîç –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è</h3>
            <div class="filter-row">
                <div class="filter-group">
                    <label for="search">–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é:</label>
                    <input type="text" id="search" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞...">
                </div>
                
                <div class="filter-group">
                    <label for="category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
                    <select id="category">
                        <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                        {% for category in categories %}
                        <option value="{{ category }}">{{ category }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="status">–°—Ç–∞—Ç—É—Å:</label>
                    <select id="status">
                        <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                        <option value="available">–î–æ—Å—Ç—É–ø–µ–Ω</option>
                        <option value="taken">–í—ã–¥–∞–Ω</option>
                    </select>
                </div>
                
                <div class="filter-buttons">
                    <button class="btn btn-apply" onclick="applyFilters()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                    <button class="btn btn-reset" onclick="resetFilters()">–°–±—Ä–æ—Å–∏—Ç—å</button>
                </div>
            </div>
        </div>
        
        {% if tools %}
        <table class="tools-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                    <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                    <th>QR-–∫–æ–¥</th>
                    <th>–ú–µ—Å—Ç–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–î–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for tool in tools %}
<tr class="tool-row" 
    data-name="{{ tool.name.lower() }}"
    data-category="{{ tool.category or '' }}"
    data-status="{{ 'available' if tool.is_available else 'taken' }}">
    <td>{{ tool.id }}</td>
    <td>
        <strong>{{ tool.name }}</strong>
        {% if tool.description %}
        <br><small style="color: #666;">{{ tool.description[:50] }}{% if tool.description|length > 50 %}...{% endif %}</small>
        {% endif %}
        
        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—ã–¥–∞—á–µ, –µ—Å–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≤—ã–¥–∞–Ω -->
        {% if not tool.is_available %}
            {% set active_request = tool.requests|selectattr('status', 'equalto', 'approved')|first %}
            {% if active_request %}
            <div class="issued-info">
                <strong>–í—ã–¥–∞–Ω:</strong> {{ active_request.user.full_name() }}<br>
                <strong>–ü–æ–ª—É—á–µ–Ω:</strong> {{ format_moscow_time(active_request.approval_time) }}<br>
                <strong>–í–µ—Ä–Ω—É—Ç—å –¥–æ:</strong> {{ format_moscow_time(active_request.expected_return_time) }}
            </div>
            {% endif %}
        {% endif %}
    </td>
    <td>{{ tool.category or '‚Äî' }}</td>
    <td>
        <code>{{ tool.qr_code_identifier }}</code>
        <br>
        <small><a href="#" onclick="showQR('{{ tool.qr_code_identifier }}', '{{ tool.name }}')">–ø–æ–∫–∞–∑–∞—Ç—å QR</a></small>
    </td>
    <td>
        {% if tool.location %}
        {{ tool.location }}
        {% if tool.storage_place %}
        <br><small>{{ tool.storage_place }}</small>
        {% endif %}
        {% else %}
        ‚Äî
        {% endif %}
    </td>
    <td>
        {% if tool.is_available %}
        <span class="status-available">‚úÖ –î–æ—Å—Ç—É–ø–µ–Ω</span>
        {% else %}
        <span class="status-taken">‚ùå –í—ã–¥–∞–Ω</span>
        {% endif %}
    </td>
    <td>{{ format_moscow_time(tool.created_at, '%d.%m.%Y %H:%M') }}</td>
    <td>
        <div class="action-buttons">
            <a href="/tool/{{ tool.qr_code_identifier }}" class="btn btn-view" target="_blank">–í–∑—è—Ç—å</a>
            <a href="#" class="btn btn-qr" onclick="showQR('{{ tool.qr_code_identifier }}', '{{ tool.name }}')">QR</a>
            <button class="btn btn-edit" onclick="window.location.href='/admin/tools/edit/{{ tool.id }}'">–ò–∑–º–µ–Ω–∏—Ç—å</button>
            <button class="btn btn-delete" data-id="{{ tool.id }}" data-name="{{ tool.name }}" onclick="deleteTool(this)">–£–¥–∞–ª–∏—Ç—å</button>
        </div>
    </td>
</tr>
{% endfor %}
            </tbody>
        </table>
        
        <div style="margin-top: 20px; text-align: center; color: #666;">
            –ü–æ–∫–∞–∑–∞–Ω–æ {{ tools|length }} –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
        </div>
        
        {% else %}
        <div class="no-data">
            <p>üì≠ –ù–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö</p>
            <p><a href="/admin/add-tool" style="color: #4CAF50; font-weight: bold;">–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç</a></p>
        </div>
        {% endif %}
        
        {% if stats.by_category %}
        <div style="margin-top: 40px; padding: 20px; background: #f5f5f5; border-radius: 8px;">
            <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h3>
            <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                <tr style="background: #e0e0e0;">
                    <th style="padding: 10px; text-align: left;">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                    <th style="padding: 10px; text-align: center;">–í—Å–µ–≥–æ</th>
                    <th style="padding: 10px; text-align: center;">–î–æ—Å—Ç—É–ø–Ω–æ</th>
                    <th style="padding: 10px; text-align: center;">–í—ã–¥–∞–Ω–æ</th>
                </tr>
                {% for category, data in stats.by_category.items() %}
                <tr style="border-bottom: 1px solid #ddd;">
                    <td style="padding: 10px;">{{ category }}</td>
                    <td style="padding: 10px; text-align: center;">{{ data.total }}</td>
                    <td style="padding: 10px; text-align: center; color: #4CAF50;">{{ data.available }}</td>
                    <td style="padding: 10px; text-align: center; color: #f44336;">{{ data.total - data.available }}</td>
                </tr>
                {% endfor %}
            </table>
        </div>
        {% endif %}
    </div>
    
    <!-- QR-–∫–æ–¥ –ø–æ–ø–∞–ø -->
    <div class="qr-overlay" id="qrOverlay" onclick="closeQR()"></div>
    <div class="qr-code-popup" id="qrPopup">
        <div class="qr-header">
            <h3 style="margin: 0;">QR-–∫–æ–¥ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞</h3>
            <button class="qr-close" onclick="closeQR()">‚úï –ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
        <div class="qr-content">
            <h4 id="qrToolName"></h4>
            <div id="qrCodeImage">
                <div style="padding: 20px; background: #f5f5f5; border-radius: 5px;">
                    <p>QR-–∫–æ–¥: <strong id="qrCodeText"></strong></p>
                    <p>–î–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ QR-–∫–æ–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª—é–±–æ–π –æ–Ω–ª–∞–π–Ω-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä</p>
                </div>
            </div>
            <div id="qrLink" class="qr-link"></div>
            <div style="margin-top: 20px;">
                <button class="btn" onclick="printQR()" style="background: #2196F3; color: white;">üñ®Ô∏è –ü–µ—á–∞—Ç—å</button>
                <button class="btn" onclick="copyQR()" style="background: #9C27B0; color: white;">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
            </div>
        </div>
    </div>
    
    <script>
        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü—ã
        function applyFilters() {
            var searchText = document.getElementById('search').value.toLowerCase();
            var categoryFilter = document.getElementById('category').value;
            var statusFilter = document.getElementById('status').value;
            
            var rows = document.querySelectorAll('.tool-row');
            var visibleCount = 0;
            
            rows.forEach(function(row) {
                var name = row.getAttribute('data-name');
                var category = row.getAttribute('data-category');
                var status = row.getAttribute('data-status');
                
                var show = true;
                
                // –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
                if (searchText && name.indexOf(searchText) === -1) {
                    show = false;
                }
                
                // –§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                if (categoryFilter && category !== categoryFilter) {
                    show = false;
                }
                
                // –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É
                if (statusFilter && status !== statusFilter) {
                    show = false;
                }
                
                row.style.display = show ? '' : 'none';
                if (show) visibleCount++;
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫
            var counter = document.querySelector('.no-data');
            if (visibleCount === 0) {
                if (!counter) {
                    counter = document.createElement('div');
                    counter.className = 'no-data';
                    var table = document.querySelector('.tools-table');
                    if (table && table.parentNode) {
                        table.parentNode.insertBefore(counter, table.nextSibling);
                    }
                }
                counter.innerHTML = '<p>üîç –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p><button class="btn btn-reset" onclick="resetFilters()">–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>';
            } else if (counter) {
                counter.parentNode.removeChild(counter);
            }
        }
        
        function resetFilters() {
            document.getElementById('search').value = '';
            document.getElementById('category').value = '';
            document.getElementById('status').value = '';
            
            var rows = document.querySelectorAll('.tool-row');
            rows.forEach(function(row) {
                row.style.display = '';
            });
            
            var noDataDiv = document.querySelector('.no-data');
            if (noDataDiv && noDataDiv.parentNode) {
                noDataDiv.parentNode.removeChild(noDataDiv);
            }
        }
        
        // –ü–æ–∫–∞–∑ QR-–∫–æ–¥–∞
        function showQR(qrCode, toolName) {
            document.getElementById('qrToolName').textContent = toolName;
            document.getElementById('qrCodeText').textContent = qrCode;
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å—Å—ã–ª–∫—É –¥–ª—è QR-–∫–æ–¥–∞
            var qrUrl = '/tool/' + qrCode;
            var fullUrl = window.location.origin + qrUrl;
            
            var linkHtml = '<strong>–°—Å—ã–ª–∫–∞:</strong><br>';
            linkHtml += '<a href="' + qrUrl + '" target="_blank">';
            linkHtml += fullUrl + '</a>';
            document.getElementById('qrLink').innerHTML = linkHtml;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ø–∞–ø
            document.getElementById('qrOverlay').style.display = 'block';
            document.getElementById('qrPopup').style.display = 'block';
        }
        
        function closeQR() {
            document.getElementById('qrOverlay').style.display = 'none';
            document.getElementById('qrPopup').style.display = 'none';
        }
        
        function printQR() {
            var toolName = document.getElementById('qrToolName').textContent;
            var qrCode = document.getElementById('qrCodeText').textContent;
            
            var printContent = '<html><head><title>QR-–∫–æ–¥: ' + toolName + '</title>' +
                '<style>body { font-family: Arial; text-align: center; padding: 20px; }' +
                'h1 { color: #333; } .qr-info { margin: 20px 0; }</style></head>' +
                '<body><h1>QR-–∫–æ–¥ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞</h1>' +
                '<div class="qr-info"><h2>' + toolName + '</h2>' +
                '<p>–ö–æ–¥: ' + qrCode + '</p>' +
                '<p>' + new Date().toLocaleDateString() + '</p></div>' +
                '<p>–û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–æ—Ä–º–µ –≤–∑—è—Ç–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞</p></body></html>';
            
            var printWindow = window.open('', '_blank');
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.print();
        }
        
        function copyQR() {
            var qrCode = document.getElementById('qrCodeText').textContent;
            var qrUrl = window.location.origin + '/tool/' + qrCode;
            
            navigator.clipboard.writeText(qrUrl).then(function() {
                alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
            }).catch(function(err) {
                console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', err);
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É');
            });
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
        function deleteTool(button) {
            var toolId = button.getAttribute('data-id');
            var toolName = button.getAttribute('data-name');
            
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç "' + toolName + '"?')) {
                return;
            }
            
            fetch('/admin/tools/delete/' + toolId, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(function(response) {
                return response.json();
            })
            .then(function(data) {
                if (data.success) {
                    alert(data.message);
                    location.reload();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + data.message);
                }
            })
            .catch(function(error) {
                alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error.message);
            });
        }
        
        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
        function editTool(toolId) {
            alert('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ ID: ' + toolId + '\n\n–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–∑–∂–µ.');
        }
        
        // –ü–æ–∏—Å–∫ –ø—Ä–∏ –≤–≤–æ–¥–µ —Ç–µ–∫—Å—Ç–∞
        document.getElementById('search').addEventListener('input', applyFilters);
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–ø–∞–ø–∞ –ø–æ ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeQR();
            }
        });
    </script>
</body>
</html>